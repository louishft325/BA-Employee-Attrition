---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r}
library(skimr)
library(tidyverse)
library(janitor)

# Load the datasets
train <- read_csv("data/train.csv")
test <- read_csv("data/test.csv")

# Display the first few rows of the train dataset
head(train)

# Get a summary of the dataset
glimpse(train)

# Skim the dataset for a comprehensive overview
skim(train)
```

```{r}
# Load necessary libraries

# Clean column names
train <- train %>% clean_names()
test <- test %>% clean_names()

# Check for missing values
train_missing <- train %>% summarise_all(~sum(is.na(.)))
test_missing <- test %>% summarise_all(~sum(is.na(.)))

# Print missing values
print(train_missing)
print(test_missing)

# Basic data preprocessing
# Handling missing values - for simplicity, we'll fill NAs with the median for numerical and mode for categorical variables
train <- train %>%
  mutate_if(is.numeric, ~ifelse(is.na(.), median(., na.rm = TRUE), .)) %>%
  mutate_if(is.character, ~ifelse(is.na(.), Mode(.), .))

test <- test %>%
  mutate_if(is.numeric, ~ifelse(is.na(.), median(., na.rm = TRUE), .)) %>%
  mutate_if(is.character, ~ifelse(is.na(.), Mode(.), .))

# Function to calculate the mode
Mode <- function(x) {
  ux <- unique(x)
  ux[which.max(tabulate(match(x, ux)))]
}

# Feature Engineering: Create new features if necessary (example shown here)
# Let's create a feature based on the age of the employee
train <- train %>%
  mutate(age_group = case_when(
    age < 30 ~ "Young",
    age >= 30 & age < 50 ~ "Middle-aged",
    age >= 50 ~ "Senior"
  ))

test <- test %>%
  mutate(age_group = case_when(
    age < 30 ~ "Young",
    age >= 30 & age < 50 ~ "Middle-aged",
    age >= 50 ~ "Senior"
  ))

# Convert new categorical features to factor
train <- train %>%
  mutate(across(where(is.character), as.factor))

test <- test %>%
  mutate(across(where(is.character), as.factor))

# Final check of the processed data
glimpse(train)
glimpse(test)

# Save the cleaned data for future use
write_csv(train, "/mnt/data/processed_train.csv")
write_csv(test, "/mnt/data/processed_test.csv")
```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
